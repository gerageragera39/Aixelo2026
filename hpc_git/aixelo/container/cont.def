Bootstrap: docker
From: nvidia/cuda:12.1.1-cudnn8-runtime-ubuntu22.04

%files
    requirements.txt /opt/requirements.txt

%post
    export DEBIAN_FRONTEND=noninteractive
    set -e

    apt-get update && apt-get install -y \
        python3 \
        python3-pip \
        python3-dev \
        git \
        ca-certificates \
        && rm -rf /var/lib/apt/lists/*

    ln -s /usr/bin/python3 /usr/bin/python
    python3 -m pip install --upgrade pip

    python3 -m pip install torch==2.1.2 torchvision==0.16.2 torchaudio==2.1.2 --index-url https://download.pytorch.org/whl/cu121

    python3 -m pip install dgl==2.1.0+cu121 -f https://data.dgl.ai/wheels/cu121/repo.html

    python3 -m pip install torchdata pydantic 
    
    python3 -m pip install rdkit dgllife pyyaml h5py

    python3 -m pip install "numpy<2.0"

    python3 -m pip install --no-cache-dir -r /opt/requirements.txt

%environment
    export PYTHONUNBUFFERED=1
    export OMP_NUM_THREADS=1
    export LC_ALL=C
